import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';
import { useQuery } from '@tanstack/react-query';

interface TranslationContextType {
  language: string;
  setLanguage: (lang: string) => void;
  t: (key: string, fallback?: string) => string;
  isLoading: boolean;
}

const TranslationContext = createContext<TranslationContextType | undefined>(undefined);

// Default translations for immediate use
const defaultTranslations = {
  en: {
    'nav.home': 'Home',
    'nav.remedies': 'Remedies',
    'nav.symptom-finder': 'Symptom Finder',
    'nav.workouts': 'Workouts',
    'nav.experts': 'Experts',
    'nav.community': 'Community',
    'nav.store': 'Store',
    'home.title': 'Discover Your Perfect Natural Remedy',
    'home.subtitle': 'Experience the world\'s most comprehensive platform for verified, plant-based solutions. No prescriptions. No guesswork. Just expert-curated, luxury natural care.',
    'home.search.placeholder': 'Describe your symptoms or what you need help with...',
    'home.search.button': 'Find Remedies',
    'home.remedy.featured.title': 'Featured Natural Remedies',
    'home.generator.badge': 'FEATURED EXPERT TOOL',
    'home.generator.title': 'Custom Remedy Generator',
    'home.generator.subtitle': 'Expert herbal knowledge creates personalized natural remedies tailored specifically to your unique health needs and preferences',
    'home.generator.cardtitle': 'Expert-Crafted Solutions',
    'home.generator.cardsubtitle': 'Personalized • Scientific • Natural',
    'home.generator.need.label': 'What do you need help with?',
    'home.generator.need.placeholder': 'Describe your health concern... (e.g., \'chronic fatigue and brain fog\', \'difficulty sleeping\', \'skin inflammation\')',
    'home.generator.preferences.label': 'Any preferences? (Optional)',
    'home.generator.preferences.placeholder': 'Tell us your preferences... (e.g., \'prefer teas over capsules\', \'no bitter tastes\', \'easy to prepare\')',
    'home.generator.button': 'Generate Custom Remedy',
    'home.generator.loading': 'Creating Your Remedy...',
    'store.title': 'PLANTRX STORE',
    'store.subtitle': 'Expert Verified • Natural Products • Premium Quality',
    'store.hero.badge': 'PREMIUM NATURAL PRODUCTS',
    'store.hero.subtitle': 'Experience the future of natural wellness with our premium collection of scientifically-backed, ethically-sourced products. Each item is verified by our expert team for maximum potency and effectiveness.',
    'store.benefits.natural': '100% NATURAL',
    'store.benefits.natural.desc': 'Certified organic ingredients sourced ethically',
    'store.benefits.verified': 'EXPERT VERIFIED',
    'store.benefits.verified.desc': 'Each product tested by our expert team',
    'store.benefits.premium': 'PREMIUM QUALITY',
    'store.benefits.premium.desc': 'Laboratory-tested for purity and potency',
    'remedies.title': 'Natural Remedies Collection',
    'remedies.subtitle': 'Explore our comprehensive database of verified natural remedies, each carefully curated by experts to provide safe and effective solutions for your health needs.',
    'remedies.search.placeholder': 'Search remedies...',
    'remedies.category.all': 'All Categories',
    'common.loading': 'Loading...',
    'common.error': 'Error loading content',
    'common.search': 'Search',
    'common.filter': 'Filter',
    'common.viewdetails': 'View Details',
    'common.buyingredients': 'Buy Ingredients',
    'home.hero.title': 'Welcome to PlantRx',
    'home.hero.subtitle': 'Expert natural remedies that work. No chemicals. No side effects. Real results.',
    'home.hero.link.remedies': 'Explore all remedies →',
    'home.hero.link.tools': 'Try the smart symptom finder →',
    'home.hero.link.store': 'Visit our supplement store →',
    'home.hero.link.about': 'About PlantRx →',
    'home.hero.research': 'All remedies backed by scientific research.',
    'home.hero.pubmed': 'View scientific studies on PubMed →',
    'home.symptom.title': 'Smart Remedy Builder',
    'home.featured.title': 'Explore Remedies',
    'home.featured.subtitle': 'Discover our most trusted, expert-verified plant-based solutions including turmeric for inflammation and ginger for digestion',
    'home.featured.seeall': 'See All Remedies',
    'home.featured.shopnow': 'Shop Now',
    'home.featured.trytools': 'Try Expert Tools',
    'home.featured.aboutus': 'About Us',
    'home.featured.bookexpert': 'Book a Health Expert',
    'home.planrx.title': 'Wellness Blueprint Designer',
    'home.planrx.subtitle': 'Generate personalized health plans in minutes. From custom diets and workout routines to skincare regimens and wellness strategies - all backed by expert knowledge and tailored to your unique needs.',
    'home.planrx.diet': 'Custom Diet Plans',
    'home.planrx.fitness': 'Fitness Routines',
    'home.planrx.skincare': 'Skincare Plans',
    'home.planrx.wellness': 'Wellness Programs',
    'home.planrx.button': 'Create My Personal Plan',
    'home.planrx.features': '✓ Expert-designed templates  •  ✓ Personalized recommendations  •  ✓ Beautiful PDF downloads',
    'home.planrx.ready': 'Ready in under 5 minutes - Sign up only to download',
    'home.remedy.prepare': 'How to Prepare',
    'home.remedy.form': 'Form',
    'home.remedy.dosage': 'Dosage',
    'home.remedy.duration': 'Treatment Duration',
    'home.remedy.safety': 'Safety Information:',
    'home.remedy.scientific': 'Scientific Basis',
    'home.remedy.important': 'Important:',
    'home.remedy.disclaimer': 'This expert-crafted remedy is for educational purposes only and should not replace professional medical advice. Always consult with a healthcare provider before starting any new treatment, especially if you have existing health conditions or take medications.',
    'features.title': 'Why PlantRx is Different',
    'features.subtitle': 'Experience the most advanced natural health platform combining smart technology, expert knowledge, and proven remedies',
    'features.ai.title': 'AI Health Analysis',
    'features.ai.description': 'Advanced symptom analysis with personalized remedy recommendations',
    'features.ai.instant': 'Instant diagnosis',
    'features.ai.accuracy': '95% accuracy',
    'features.ai.personalized': 'Personalized results',
    'features.ai.badge': 'Most Popular',
    'features.remedies.title': 'Expert-Verified Remedies',
    'features.remedies.description': '166+ natural remedies curated by herbalists and researchers',
    'features.remedies.scientifically': 'Scientifically backed',
    'features.remedies.traditional': 'Traditional wisdom',
    'features.remedies.quality': 'Quality tested',
    'features.remedies.badge': 'Verified',
    'features.network.title': 'Global Expert Network',
    'features.network.description': 'Connect with certified healers and wellness professionals worldwide',
    'features.network.certified': 'Certified experts',
    'features.network.worldwide': '47+ countries',
    'features.network.available': '24/7 available',
    'features.network.badge': 'Trusted',
    'features.safe.title': 'Safe & Natural',
    'features.safe.description': 'No side effects, no synthetic chemicals, just pure plant power',
    'features.safe.nontoxic': 'Non-toxic',
    'features.safe.gentle': 'Gentle healing',
    'features.safe.longterm': 'Long-term wellness',
    'features.safe.badge': 'Guaranteed',
    'features.instant.title': 'Instant Results',
    'features.instant.description': 'Get remedy recommendations in seconds, not hours',
    'features.instant.realtime': 'Real-time analysis',
    'features.instant.quick': 'Quick relief',
    'features.instant.emergency': 'Emergency guidance',
    'features.instant.badge': 'Fast',
    'features.proven.title': 'Proven Success',
    'features.proven.description': 'Join 50,000+ users who transformed their health naturally',
    'features.proven.testimonials': 'Real testimonials',
    'features.proven.measurable': 'Measurable results',
    'features.proven.lifechanging': 'Life-changing',
    'features.proven.badge': 'Trusted',
    'features.expert.title': 'Expert Community',
    'features.expert.description': 'Connect with certified natural health practitioners',
    'features.expert.support': '24/7 support',
    'features.expert.guidance': 'Professional guidance',
    'features.expert.wisdom': 'Community wisdom',
    'features.expert.badge': 'Premium',
    'header.plantrx': 'PlantRx',
    'header.cart': 'Cart',
    'header.login': 'Login',
    'header.signup': 'Sign Up',
    'header.logout': 'Logout',
    'header.profile': 'Profile',
    'header.language': 'Language',
    'header.theme.toggle': 'Toggle theme',
    'header.menu': 'Menu',
    'header.close': 'Close',
    'header.premium.title': 'PlantRx Premium',
    'header.premium.description': 'Unlock exclusive health insights, personalized remedy plans, and direct expert consultations.',
    'header.premium.features.insights': 'Advanced Health Insights',
    'header.premium.features.plans': 'Personalized Remedy Plans',
    'header.premium.features.experts': '1-on-1 Expert Consultations',
    'header.premium.features.priority': 'Priority Support',
    'header.premium.features.library': 'Exclusive Remedy Library',
    'header.premium.price': '$9.99/month',
    'header.premium.button': 'Upgrade Now',
    'header.cart.empty': 'Your cart is empty',
    'header.cart.item': 'item',
    'header.cart.items': 'items',
    'header.cart.checkout': 'Proceed to Checkout',
    'header.cart.continue': 'Continue Shopping',
    'header.cart.remove': 'Remove from cart',
    'header.cart.quantity': 'Qty',
    'ui.your_cart': 'Shopping Cart',
    'ui.items': 'items',
    'ui.cart_empty': 'Your cart is empty',
    'ui.browse_products': 'Browse Products',
    'ui.total': 'Total',
    'ui.checkout': 'Checkout',
    'ui.continue_shopping': 'Continue Shopping',
    'ui.dashboard': 'Dashboard',
    'ui.premium_cart_title': 'Premium Shopping Cart',
    'ui.premium_cart_description': 'Access exclusive natural health products and remedies',
    'ui.create_account': 'Create Free Account',
    'ui.sign_in': 'Sign In',
    'ui.sign_up': 'Sign Up',
    'ui.premium': 'PREMIUM',
    'ui.click_details': 'Click to view details →',
    'ui.key_benefits': 'Key Benefits',
    'ui.ingredients': 'Ingredients',
    'difficulty.easy': 'Easy',
    'difficulty.medium': 'Medium',
    'difficulty.advanced': 'Advanced',
    'time.instant': 'Instant',
    'time.5min': '5min',
    'time.10min': '10min',
    'time.30min': '30min+',
    'nav.about': 'About',
    'nav.blog': 'Articles',
    'footer.privacy': 'Privacy',
    'footer.terms': 'Terms',
    'footer.stats.users': 'Active Users',
    'footer.stats.remedies': 'Remedies',
    'footer.stats.rating': 'Rating',
    'footer.description': 'The world\'s most trusted natural health platform, connecting you with expert-verified plant remedies and personalized wellness guidance from real practitioners.',
    'footer.copyright': '© 2025 PlantRx Ltd.',
    'footer.tagline': 'Expert-verified natural healing',
  },
  es: {
    'nav.home': 'Inicio',
    'nav.remedies': 'Remedios',
    'nav.symptom-finder': 'Buscador de Síntomas',
    'nav.workouts': 'Ejercicios',
    'nav.experts': 'Expertos',
    'nav.community': 'Comunidad',
    'nav.store': 'Tienda',
    'home.title': 'Descubre Tu Remedio Natural Perfecto',
    'home.subtitle': 'Experimenta la plataforma más completa del mundo para soluciones verificadas a base de plantas. Sin recetas. Sin conjeturas. Solo cuidado natural de lujo curado por expertos.',
    'home.search.placeholder': 'Describe tus síntomas o en qué necesitas ayuda...',
    'home.search.button': 'Encontrar Remedios',
    'home.remedy.featured.title': 'Remedios Naturales Destacados',
    'home.hero.title': 'Bienvenido a PlantRx – Tu Plataforma de Remedios Naturales',
    'home.hero.subtitle': 'Remedios naturales expertos que funcionan. Sin químicos. Sin efectos secundarios. Resultados reales.',
    'home.hero.link.remedies': 'Explorar todos los remedios →',
    'home.hero.link.tools': 'Probar el buscador inteligente de síntomas →',
    'home.hero.link.store': 'Visitar nuestra tienda de suplementos →',
    'home.hero.link.about': 'Sobre PlantRx →',
    'home.hero.research': 'Todos los remedios respaldados por investigación científica.',
    'home.hero.pubmed': 'Ver estudios científicos en PubMed →',
    'home.symptom.title': 'Constructor Inteligente de Remedios',
    'home.featured.title': 'Explorar Remedios',
    'home.planrx.title': 'Diseñador de Planes de Bienestar',
    'home.planrx.subtitle': 'Genera planes de salud personalizados en minutos. Desde dietas personalizadas y rutinas de ejercicio hasta regímenes de cuidado de la piel y estrategias de bienestar, todo respaldado por conocimiento experto y adaptado a tus necesidades únicas.',
    'home.planrx.button': 'Crear Mi Plan Personal',
    'store.title': 'TIENDA PLANTRX',
    'store.subtitle': 'Verificado por Expertos • Productos Naturales • Calidad Premium',
    'common.loading': 'Cargando...',
    'common.error': 'Error al cargar contenido',
  },
  fr: {
    'nav.home': 'Accueil',
    'nav.remedies': 'Remèdes',
    'nav.symptom-finder': 'Chercheur de Symptômes',
    'nav.workouts': 'Exercices',
    'nav.experts': 'Experts',
    'nav.community': 'Communauté',
    'nav.store': 'Boutique',
    'home.title': 'Découvrez Votre Remède Naturel Parfait',
    'home.subtitle': 'Découvrez la plateforme la plus complète au monde pour des solutions vérifiées à base de plantes. Pas d\'ordonnances. Pas de devinettes. Juste des soins naturels de luxe sélectionnés par des experts.',
    'home.search.placeholder': 'Décrivez vos symptômes ou ce dont vous avez besoin...',
    'home.search.button': 'Trouver des Remèdes',
    'home.remedy.featured.title': 'Remèdes Naturels en Vedette',
    'home.hero.title': 'Bienvenue à PlantRx – Votre Plateforme de Remèdes Naturels',
    'home.hero.subtitle': 'Des remèdes naturels experts qui fonctionnent. Aucun produit chimique. Aucun effet secondaire. De vrais résultats.',
    'home.hero.link.remedies': 'Explorer tous les remèdes →',
    'home.hero.link.tools': 'Essayer le chercheur intelligent de symptômes →',
    'home.hero.link.store': 'Visiter notre magasin de suppléments →',
    'home.hero.link.about': 'À propos de PlantRx →',
    'home.hero.research': 'Tous les remèdes soutenus par la recherche scientifique.',
    'home.hero.pubmed': 'Voir les études scientifiques sur PubMed →',
    'home.symptom.title': 'Constructeur Intelligent de Remèdes',
    'home.featured.title': 'Explorer les Remèdes',
    'home.planrx.title': 'Concepteur de Plans de Bien-être',
    'home.planrx.subtitle': 'Générez des plans de santé personnalisés en minutes. Des régimes personnalisés et routines d\'exercice aux régimes de soins de la peau et stratégies de bien-être - le tout soutenu par des connaissances d\'expert et adapté à vos besoins uniques.',
    'home.planrx.button': 'Créer Mon Plan Personnel',
    'store.title': 'BOUTIQUE PLANTRX',
    'store.subtitle': 'Vérifié par les Experts • Produits Naturels • Qualité Premium',
    'common.loading': 'Chargement...',
    'common.error': 'Erreur lors du chargement du contenu',
  },
  de: {
    'nav.home': 'Startseite',
    'nav.remedies': 'Heilmittel',
    'nav.symptom-finder': 'Symptom-Finder',
    'nav.workouts': 'Workouts',
    'nav.experts': 'Experten',
    'nav.community': 'Gemeinschaft',
    'nav.store': 'Shop',
    'home.title': 'Entdecken Sie Ihr Perfektes Naturheilmittel',
    'home.subtitle': 'Erleben Sie die umfassendste Plattform der Welt für verifizierte, pflanzenbasierte Lösungen. Keine Rezepte. Keine Vermutungen. Nur von Experten kuratierte, luxuriöse Naturpflege.',
    'home.search.placeholder': 'Beschreiben Sie Ihre Symptome oder wobei Sie Hilfe brauchen...',
    'home.search.button': 'Heilmittel Finden',
    'home.remedy.featured.title': 'Empfohlene Naturheilmittel',
    'home.hero.title': 'Willkommen bei PlantRx – Ihrer Naturheilmittel-Plattform',
    'home.hero.subtitle': 'Expertenheilmittel, die funktionieren. Keine Chemikalien. Keine Nebenwirkungen. Echte Ergebnisse.',
    'home.hero.link.remedies': 'Alle Heilmittel erkunden →',
    'home.hero.link.tools': 'Den intelligenten Symptom-Finder ausprobieren →',
    'home.hero.link.store': 'Unseren Nahrungsergänzungsstore besuchen →',
    'home.hero.link.about': 'Über PlantRx →',
    'home.hero.research': 'Alle Heilmittel durch wissenschaftliche Forschung belegt.',
    'home.hero.pubmed': 'Wissenschaftliche Studien auf PubMed ansehen →',
    'home.symptom.title': 'Intelligenter Heilmittel-Builder',
    'home.featured.title': 'Heilmittel Erkunden',
    'home.planrx.title': 'Wellness-Plan Designer',
    'home.planrx.subtitle': 'Erstellen Sie personalisierte Gesundheitspläne in Minuten. Von individuellen Diäten und Trainingsroutinen bis hin zu Hautpflegeroutinen und Wellness-Strategien - alles unterstützt von Expertenwissen und maßgeschneidert für Ihre einzigartigen Bedürfnisse.',
    'home.planrx.button': 'Meinen Persönlichen Plan Erstellen',
    'store.title': 'PLANTRX SHOP',
    'store.subtitle': 'Expertengeprüft • Naturprodukte • Premium-Qualität',
    'common.loading': 'Laden...',
    'common.error': 'Fehler beim Laden des Inhalts',
  },
  ar: {
    'nav.home': 'الرئيسية',
    'nav.remedies': 'العلاجات',
    'nav.symptom-finder': 'باحث الأعراض',
    'nav.workouts': 'التمارين',
    'nav.experts': 'الخبراء',
    'nav.community': 'المجتمع',
    'nav.store': 'المتجر',
    'home.title': 'اكتشف علاجك الطبيعي المثالي',
    'home.subtitle': 'اختبر أشمل منصة في العالم للحلول النباتية المعتمدة. بلا وصفات طبية. بلا تخمين. فقط رعاية طبيعية فاخرة منتقاة من قبل الخبراء.',
    'home.search.placeholder': 'صف أعراضك أو ما تحتاج المساعدة فيه...',
    'home.search.button': 'البحث عن علاجات',
    'home.remedy.featured.title': 'العلاجات الطبيعية المميزة',
    'home.hero.title': 'مرحباً بكم في PlantRx – منصتكم للعلاجات الطبيعية',
    'home.hero.subtitle': 'علاجات طبيعية من الخبراء تعمل بفعالية. لا مواد كيميائية. لا آثار جانبية. نتائج حقيقية.',
    'home.hero.link.remedies': 'استكشاف جميع العلاجات →',
    'home.hero.link.tools': 'تجربة باحث الأعراض الذكي →',
    'home.hero.link.store': 'زيارة متجر المكملات الغذائية →',
    'home.hero.link.about': 'حول PlantRx →',
    'home.hero.research': 'جميع العلاجات مدعومة بالبحوث العلمية.',
    'home.hero.pubmed': 'عرض الدراسات العلمية على PubMed →',
    'home.symptom.title': 'منشئ العلاجات الذكي',
    'home.featured.title': 'استكشاف العلاجات',
    'home.planrx.title': 'مصمم مخططات العافية',
    'home.planrx.subtitle': 'إنشاء خطط صحية مخصصة في دقائق. من الحميات المخصصة وروتين اللياقة إلى روتين العناية بالبشرة واستراتيجيات العافية - كلها مدعومة بمعرفة الخبراء ومصممة خصيصاً لاحتياجاتك الفريدة.',
    'home.planrx.button': 'إنشاء خطتي الشخصية',
    'home.generator.badge': 'أداة الخبراء المميزة',
    'home.generator.title': 'مولد العلاجات المخصصة',
    'home.generator.subtitle': 'المعرفة العشبية للخبراء تخلق علاجات طبيعية شخصية مصممة خصيصاً لاحتياجاتك الصحية وتفضيلاتك الفريدة',
    'home.generator.cardtitle': 'حلول مصنوعة من قبل الخبراء',
    'home.generator.cardsubtitle': 'شخصي • علمي • طبيعي',
    'home.generator.need.label': 'بماذا تحتاج المساعدة؟',
    'home.generator.need.placeholder': 'صف مشكلتك الصحية... (مثل: "التعب المزمن وضباب الدماغ"، "صعوبة النوم"، "التهاب الجلد")',
    'home.generator.preferences.label': 'أي تفضيلات؟ (اختياري)',
    'home.generator.preferences.placeholder': 'أخبرنا بتفضيلاتك... (مثل: "أفضل الشاي على الكبسولات"، "لا طعم مر"، "سهل التحضير")',
    'home.generator.button': 'إنشاء علاج مخصص',
    'home.generator.loading': 'إنشاء علاجك...',
    'store.title': 'متجر PLANTRX',
    'store.subtitle': 'معتمد من الخبراء • منتجات طبيعية • جودة ممتازة',
    'store.hero.badge': 'منتجات طبيعية ممتازة',
    'store.hero.subtitle': 'اختبر مستقبل العافية الطبيعية مع مجموعتنا المتميزة من المنتجات المدعومة علمياً والمصدرة أخلاقياً. كل عنصر معتمد من قبل فريق خبرائنا للحصول على أقصى قوة وفعالية.',
    'store.benefits.natural': '100% طبيعي',
    'store.benefits.natural.desc': 'مكونات عضوية معتمدة مصدرها أخلاقي',
    'store.benefits.verified': 'معتمد من الخبراء',
    'store.benefits.verified.desc': 'كل منتج مختبر من قبل فريق الخبراء لدينا',
    'store.benefits.premium': 'جودة ممتازة',
    'store.benefits.premium.desc': 'مختبر في المعمل للنقاء والفعالية',
    'remedies.title': 'مجموعة العلاجات الطبيعية',
    'remedies.subtitle': 'استكشف قاعدة بياناتنا الشاملة للعلاجات الطبيعية المعتمدة، كل واحد منتقى بعناية من قبل الخبراء لتوفير حلول آمنة وفعالة لاحتياجاتك الصحية.',
    'remedies.search.placeholder': 'البحث في العلاجات...',
    'remedies.category.all': 'جميع الفئات',
    'common.loading': 'جاري التحميل...',
    'common.error': 'خطأ في تحميل المحتوى',
    'common.search': 'بحث',
    'common.filter': 'تصفية',
    'common.viewdetails': 'عرض التفاصيل',
    'common.buyingredients': 'شراء المكونات',
  },
  zh: {
    'nav.home': '首页',
    'nav.remedies': '草药',
    'nav.symptom-finder': '症状查找器',
    'nav.workouts': '锻炼',
    'nav.experts': '专家',
    'nav.community': '社区',
    'nav.store': '商店',
    'home.title': '发现您完美的天然疗法',
    'home.subtitle': '体验世界上最全面的经过验证的植物性解决方案平台。无需处方。无需猜测。只有专家策划的豪华天然护理。',
    'home.search.placeholder': '描述您的症状或需要帮助的地方...',
    'home.search.button': '查找疗法',
    'home.remedy.featured.title': '特色天然疗法',
    'home.hero.title': '欢迎来到 PlantRx – 您的天然疗法平台',
    'home.hero.subtitle': '专家级天然疗法，真正有效。无化学物质。无副作用。真实结果。',
    'home.hero.link.remedies': '探索所有疗法 →',
    'home.hero.link.tools': '试用智能症状查找器 →',
    'home.hero.link.store': '参观我们的补品商店 →',
    'home.hero.link.about': '关于 PlantRx →',
    'home.hero.research': '所有疗法都经科学研究支持。',
    'home.hero.pubmed': '在 PubMed 上查看科学研究 →',
    'home.symptom.title': '智能配方生成器',
    'home.featured.title': '探索疗法',
    'home.planrx.title': '健康蓝图设计师',
    'home.planrx.subtitle': '在几分钟内生成个性化健康计划。从定制饮食和锻炼例行到护肤方案和健康策略 - 所有这些都由专家知识支持，专为您的独特需求量身定制。',
    'home.planrx.button': '创建我的个人计划',
    'store.title': 'PLANTRX 商店',
    'store.subtitle': '专家验证 • 天然产品 • 优质品质',
    'common.loading': '加载中...',
    'common.error': '内容加载错误',
  }
};

interface TranslationProviderProps {
  children: ReactNode;
}

export function TranslationProvider({ children }: TranslationProviderProps) {
  const [language, setLanguageState] = useState(() => {
    return localStorage.getItem('plantrx-language') || 'en';
  });

  // Fetch translations from database
  const { data: databaseTranslations, isLoading } = useQuery({
    queryKey: ['/api/translations', language],
    queryFn: async () => {
      const response = await fetch(`/api/translations/${language}`);
      if (!response.ok) {
        throw new Error('Failed to fetch translations');
      }
      return response.json();
    },
    staleTime: 5 * 60 * 1000, // 5 minutes
    enabled: language !== 'en', // Only fetch for non-English languages
  });

  const setLanguage = (lang: string) => {
    setLanguageState(lang);
    localStorage.setItem('plantrx-language', lang);
  };

  const t = (key: string, fallback?: string): string => {
    // First check database translations
    if (databaseTranslations && databaseTranslations[key]) {
      return databaseTranslations[key];
    }

    // Then check default translations
    const defaultLangTranslations = defaultTranslations[language as keyof typeof defaultTranslations];
    if (defaultLangTranslations && defaultLangTranslations[key as keyof typeof defaultLangTranslations]) {
      return defaultLangTranslations[key as keyof typeof defaultLangTranslations];
    }

    // Fall back to English default translations
    const englishTranslations = defaultTranslations.en;
    if (englishTranslations[key as keyof typeof englishTranslations]) {
      return englishTranslations[key as keyof typeof englishTranslations];
    }

    // Use provided fallback or return the key itself
    return fallback || key;
  };

  return (
    <TranslationContext.Provider value={{ language, setLanguage, t, isLoading }}>
      {children}
    </TranslationContext.Provider>
  );
}

export function useTranslation() {
  const context = useContext(TranslationContext);
  if (context === undefined) {
    throw new Error('useTranslation must be used within a TranslationProvider');
  }
  return context;
}